対向Public STUNサーバー `stun.l.google.com:19302`

# coturnでSTUN捌く様子を見る
# UDPソケットを張ってSTUNメッセージを受信してみる(単発)
# UDPサーバーのループを貼る
-> ループ張ってもだめ
stun-clientを複数回起動しても返事するので、ループ自体は張れていることはわかった。
stun-clientが健全に動くためにはレスポンスを返す必要がある。

# tcpdumpを入れる
stun-testerにtcpdumpを入れてreq/resを見る。

```
root@273c33590115:/# tcpdump -n udp -X
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes


06:40:35.275955 IP 172.20.0.3.39464 > 172.20.0.2.3478: UDP, length 20
        0x0000:  4500 0030 e378 4000 4011 ff16 ac14 0003  E..0.x@.@.......
        0x0010:  ac14 0002 9a28 0d96 001c 585b 0001 0000  .....(....X[....
        0x0020:  2112 a442 bd4e 0f15 5ad9 4050 0d87 9f95  !..B.N..Z.@P....
06:40:35.276220 IP 172.20.0.2.3478 > 172.20.0.3.39464: UDP, length 96
        0x0000:  4500 007c ae85 4000 4011 33be ac14 0002  E..|..@.@.3.....
        0x0010:  ac14 0003 0d96 9a28 0068 58a7 0101 004c  .......(.hX....L
        0x0020:  2112 a442 bd4e 0f15 5ad9 4050 0d87 9f95  !..B.N..Z.@P....
        0x0030:  0020 0008 0001 bb3a 8d06 a441 0001 0008  .......:...A....
        0x0040:  0001 9a28 ac14 0003 802b 0008 0001 0d96  ...(.....+......
        0x0050:  ac14 0002 802c 0008 0001 0d97 ac14 0002  .....,..........
        0x0060:  8022 0016 436f 7475 726e 2d34 2e32 2e31  ."..Coturn-4.2.1
        0x0070:  2e32 2027 4d6f 6e7a 6127 0000            .2.'Monza'..
06:40:35.279323 IP 172.20.0.3.39464 > 172.20.0.2.3478: UDP, length 36
        0x0000:  4500 0040 e379 4000 4011 ff05 ac14 0003  E..@.y@.@.......
        0x0010:  ac14 0002 9a28 0d96 002c 586b 0001 0010  .....(...,Xk....
        0x0020:  2112 a442 2691 0d08 a8e1 2966 006f 87ae  !..B&.....)f.o..
        0x0030:  0027 0004 9a29 0000 0003 0004 0000 0006  .'...)..........
06:40:35.279864 IP 172.20.0.2.3479 > 172.20.0.3.39465: UDP, length 96
        0x0000:  4500 007c ae86 4000 4011 33bd ac14 0002  E..|..@.@.3.....
        0x0010:  ac14 0003 0d97 9a29 0068 58a7 0101 004c  .......).hX....L
        0x0020:  2112 a442 2691 0d08 a8e1 2966 006f 87ae  !..B&.....)f.o..
        0x0030:  0020 0008 0001 bb3a 8d06 a441 0001 0008  .......:...A....
        0x0040:  0001 9a28 ac14 0003 802b 0008 0001 0d97  ...(.....+......
        0x0050:  ac14 0002 802c 0008 0001 0d97 ac14 0002  .....,..........
        0x0060:  8022 0016 436f 7475 726e 2d34 2e32 2e31  ."..Coturn-4.2.1
        0x0070:  2e32 2027 4d6f 6e7a 6127 0000            .2.'Monza'..
06:40:35.287446 IP 172.20.0.3.39465 > 172.20.0.2.3478: UDP, length 1532
        0x0000:  4500 0618 e37a 0000 4011 392d ac14 0003  E....z..@.9-....
        0x0010:  ac14 0002 9a29 0d96 0604 5e43 0001 05e8  .....)....^C....
        0x0020:  2112 a442 1ffc 6fbe 0bf3 b451 d455 eba4  !..B..o....Q.U..
        0x0030:  0003 0004 0000 0006 0026 05dc 0000 0000  .........&......
        0x0040:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0050:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0060:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0070:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0080:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0090:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0100:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0110:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0120:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0130:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0140:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0150:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0160:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0170:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0180:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0190:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0200:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0210:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0220:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0230:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0240:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0250:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0260:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0270:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0280:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0290:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0300:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0310:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0320:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0330:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0340:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0350:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0360:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0370:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0380:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0390:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0400:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0410:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0420:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0430:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0440:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0450:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0460:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0470:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0480:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0490:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0500:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0510:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0520:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0530:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0540:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0550:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0560:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0570:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0580:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0590:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0600:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0610:  0000 0000 0000 0000                      ........
06:40:35.292219 IP 172.20.0.2.3479 > 172.20.0.3.39465: UDP, length 1600
        0x0000:  4500 065c ae87 0000 4011 6ddc ac14 0002  E..\....@.m.....
        0x0010:  ac14 0003 0d97 9a29 0648 5e87 0101 062c  .......).H^....,
        0x0020:  2112 a442 1ffc 6fbe 0bf3 b451 d455 eba4  !..B..o....Q.U..
        0x0030:  0020 0008 0001 bb3b 8d06 a441 0001 0008  .......;...A....
        0x0040:  0001 9a29 ac14 0003 802b 0008 0001 0d97  ...).....+......
        0x0050:  ac14 0002 802c 0008 0001 0d97 ac14 0002  .....,..........
        0x0060:  0026 05dc 0000 0000 0000 0000 0000 0000  .&..............
        0x0070:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0080:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0090:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x00f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0100:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0110:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0120:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0130:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0140:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0150:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0160:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0170:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0180:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0190:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x01f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0200:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0210:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0220:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0230:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0240:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0250:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0260:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0270:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0280:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0290:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x02f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0300:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0310:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0320:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0330:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0340:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0350:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0360:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0370:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0380:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0390:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x03f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0400:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0410:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0420:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0430:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0440:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0450:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0460:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0470:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0480:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0490:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x04f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0500:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0510:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0520:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0530:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0540:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0550:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0560:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0570:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0580:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0590:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x05f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0600:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0610:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0620:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0630:  0000 0000 0000 0000 0000 0000 0000 0000  ................
        0x0640:  8022 0016 436f 7475 726e 2d34 2e32 2e31  ."..Coturn-4.2.1
        0x0650:  2e32 2027 4d6f 6e7a 6127 0000            .2.'Monza'..
```


- [x] coturnを使ったやつ
- [ ] データグラム編
    - [x] UDPソケットを張ってstunメッセージ受信してみる
    - [ ] ヘッダを作る
    - [ ] stun.l.google.com:19302
    - [ ] Magic Cookie
- [ ] 抽象オブジェクト編
    - [ ] Indication
    - [ ] Request
    - [ ] Response
    - [ ] Error Response
- [ ] プロトコル編
- [ ] Attributes編
    - [ ] MAPPED-ADDRESS
    - [ ] USERNAME
    - [ ] MESSAGE-INTEGRITY
    - [ ] ERROR-CODE
    - [ ] UNKNOWN-ATTRIBUTES
    - [ ] REALM
    - [ ] NONCE
    - [ ] XOR-MAPPED-ADDRESS
    - [ ] SOFTWARE
    - [ ] ALTERNATE-SERVER
    - [ ] FINGERPRINT

## STUN UDP and TCP Port Numbers
```
stun   3478/tcp   Session Traversal Utilities for NAT (STUN) port
stun   3478/udp   Session Traversal Utilities for NAT (STUN) port
```
